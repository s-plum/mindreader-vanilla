Element.prototype.mindreader=function(e){var t=function(){Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,a;if(null==this)throw new TypeError(" this is null or not defined");var s=Object(this),r=s.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),a=0;r>a;){var i;a in s&&(i=s[a],e.call(n,i,a,s)),a++}}),Array.convertNodeList=function(e){for(var t=new Array(e.length),n=0,a=e.length;a>n;n++)t[n]=e[n];return t},Element.prototype._find=function(e){var t=this.id?!0:!1;t||(this.id="temp-"+Math.random().toString(36).substr(2));var n=document.querySelectorAll("#"+this.id+" "+e);return n.length>0?Array.convertNodeList(n):[]},Element.prototype._empty=function(){for(;this.hasChildNodes();)this.removeChild(this.lastChild)},Element.prototype._setAttributes=function(e){for(var t in e)this.setAttribute(t,e[t])},Element.prototype._addClass=function(e){if(this.className.length){var t=e.split(" "),n=this.className.split(" ");t.forEach(function(e){n.indexOf(e)>=0&&t.splice(t.indexOf(e),1)}),t.length>0&&(this.className+=" "+t.join(" "))}else this.className=e},Element.prototype._removeClass=function(e){if(this.className.length>0){var t=e.split(" "),n=this.className.split(" ");t.forEach(function(e){n.indexOf(e)>=0&&n.splice(n.indexOf(e),1)}),this.className=n.join(" ")}},Element.prototype._text=function(e){return e&&"string"!=typeof e&&(e=!1),e||!this.innerText&&!this.textContent?(e&&("textContent"in document.body?this.textContent=e:this.innerText=e),void 0):this.innerText||this.textContent},Element.prototype._triggerMouseEvent=function(e){var t;document.createEvent&&(t=document.createEvent("MouseEvents"),t.initMouseEvent(e,!0,!0)),t?this.dispatchEvent(t):el[e]&&el[e]()},Object.prototype._mergeWith=function(e,t){var n=[];switch(Object.prototype.toString.call(e)){case"[object Array]":n=e;break;case"[object Object]":n.push(e);break;default:return this}if(0===n.length)return this;var a={};for(var s in this)a[s]=this[s];for(var r=0;r<n.length;r++)for(var s in n[r])(t||!a[s])&&(a[s]=n[r][s]);return a}},n=function(){var e={get:"GET",post:"POST"},t=function(t){var n={method:e.post,url:"",data:null,callback:function(){return!0},errorCallback:function(){return!1}},a=t._mergeWith(n),s="";if(a.data){var r=[];for(var i in a.data)r.push(encodeURIComponent(i)+"="+encodeURIComponent(a.data[i]));s=r.join("&")}if(a.method===e.get&&s.length>0){var l="?";a.url.indexOf("?")>=0&&(l="&"),a.url+=l+s,s=null}var o=new XMLHttpRequest;if("withCredentials"in o)o.open(a.method,a.url,!0);else{if("undefined"==typeof XDomainRequest)return!1;o=new XDomainRequest,o.open(a.method,a.url)}o.setRequestHeader("Content-type","application/json"),o.onreadystatechange=function(){if(o.readyState!=XMLHttpRequest.DONE&&4!==o.readyState||200!=o.status||!a.callback)a.errorCallback&&a.errorCallback(e);else{var e=o.responseText;try{e=JSON.parse(o.responseText)}catch(t){a.errorCallback&&a.errorCallback(e),e=null}null!=e&&a.callback&&a.callback(e)}},o.send(s)},n=function(n){n.method=e.get,t(n)},a=function(n){n.method=e.post,t(n)};return{get:n,post:a}},a={BACKSPACE:8,DOWN:40,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,RIGHT:39,TAB:9,UP:38},s={status:"mindreader-status",results:"mindreader-results",active:"active",nomatch:"mindreader-nomatch",resultsOpen:"mindreader-results-open"},r={currentVal:"data-current-val"},i={up:0,down:1},l={ajaxUrl:"",parseMatches:null,matchSelected:null,matchStatus:"{0} items found. Use up and down arrow keys to navigate.",noMatchStatus:null,postData:null,actionType:"POST",matchEvents:"mouseover click",minLength:1,searchPause:50,errorCallback:function(){return!1}},o={create:function(e,t){this.el=e,this.el.setAttribute(r.currentVal,""),this.parent=e.parentNode,this.config=l._mergeWith(t,!0),this.searchTimeout,this.activeItem={el:null,index:null},this.resultsData=[];var n=document.createElement("span");n._setAttributes({role:"status","class":s.status,"aria-live":"polite"});var a=document.createElement("ul");a._setAttributes({"class":s.results,id:this.el.id+"-mindreader"}),this.results=a,this.statusBox=n,document.getElementsByTagName("body")[0].appendChild(this.results),document.getElementsByTagName("body")[0].appendChild(this.statusBox),this.bindDomEvents()},bindDomEvents:function(){var e=this;window.addEventListener("resize",function(){e.positionResults()}),e.el.addEventListener("keydown",function(t){var n=t.keyCode?t.keyCode:t.which;switch(n){case a.ESCAPE:e.el.value=e.el.getAttribute(r.currentVal),t.preventDefault(),e.clearResults();break;case a.TAB:e.clearResults();break;case a.ENTER:null!=e.activeItem.el?(e.activeItem.el._triggerMouseEvent("click"),t.preventDefault()):e.clearResults();break;case a.UP:t.preventDefault()}}),e.el.addEventListener("keyup",function(t){clearTimeout(e.searchTimeout);var n=t.keyCode?t.keyCode:t.which;switch(n){case a.DOWN:t.preventDefault(),e.resultsData.length>0&&e.moveListSelection(i.down);break;case a.UP:t.preventDefault(),e.resultsData.length>0&&e.moveListSelection(i.up);break;case a.ENTER:if(null==e.activeItem.el)break;t.preventDefault(),e.clearResults();case a.ESCAPE:t.preventDefault(),e.clearResults();break;default:e.search()}}),e.el.addEventListener("blur",function(){setTimeout(function(){0===e.results._find("a:hover").length&&0===e.results._find("a:focus").length&&0===e.results._find("a:active").length&&(e.clearResults(),e.el.setAttribute(r.currentVal,""))},100)})},search:function(){var e=this,t=e.el.value;e.el.setAttribute(r.currentVal,t),t.length>=e.config.minLength?e.searchTimeout=setTimeout(function(){if(null!=e.config.postData&&"function"==typeof e.config.postData&&"object"==typeof e.config.postData())var a=JSON.stringify(e.config.postData());else var a=null;var s=new n;s[e.config.actionType.toLowerCase()]({url:e.config.ajaxUrl+t,data:a,callback:function(t){"string"==typeof t&&(t=JSON.parse(t)),"[object Array]"===Object.prototype.toString.call(t)&&null!=e.config.parseMatches&&e.parseResults(t)},errorCallback:e.config.errorCallback})},e.config.searchPause):e.clearResults()},parseResults:function(e){var t=this;if(t.clearResults(),0===e.length){if(null!=t.config.noMatchStatus){var n=document.createElement("li");n.className=s.nomatch,n._text(t.config.noMatchStatus),t.results.appendChild(n),t.statusBox._text(t.config.noMatchStatus)}return t.showResults(),t.el._addClass(s.resultsOpen),!1}switch(t.resultsData=e,t.displayData=t.config.parseMatches(e),Object.prototype.toString.call(t.displayData)){case"[object Array]":var a=t.displayData.length;t.displayData.length>0&&t.displayData.forEach(function(e){1===e.nodeType&&t.results.appendChild(e)});break;case"[object String]":var a=t.resultsData.length;t.results.innerHTML=t.config.parseMatches(e)}a>0&&t.statusBox._text(t.config.matchStatus.replace("{0}",a)),t.showResults(),t.el._addClass(s.resultsOpen);var r=t.results._find("a");r.length>0&&r.forEach(function(e,n){if(e.onclick=function(e){e.preventDefault(),t.el.value=e.target._text(),t.clearResults(),t.el.focus()},e.onmouseover=function(e){null!=t.activeItem.el&&t.activeItem.el._removeClass(s.active),e.target._addClass(s.active),t.activeItem.el=e.target,t.activeItem.index=n},null!=t.config.matchSelected&&t.config.matchEvents&&t.config.matchEvents.length>0){var a=t.config.matchEvents.split(" ");a.forEach(function(n){e.addEventListener(n,t.config.matchSelected)})}})},clearResults:function(){var e=this;e.resultsData=[],e.activeItem.el=null,e.activeItem.index=null,e.el._removeClass(s.resultsOpen),e.statusBox.innerHTML="",e.results._empty()},positionResults:function(){var e=this,t=e.el.offsetHeight,n=e.el.offsetWidth,a=e.el.offsetLeft,s=e.el.offsetTop;e.results.style.width=n+"px",e.results.style.left=a+"px",e.results.style.top=s+t+"px"},hideResults:function(){this.results.setAttribute("aria-hidden","true"),this.results.style.display="none"},showResults:function(){this.positionResults(),this.results.removeAttribute("aria-hidden"),this.results.style.display="block"},moveListSelection:function(e){var t=this,n=t.results._find("li");switch(e){case i.down:var a=0,l=function(e){return e++,e},o=t.activeItem.index===n.length-1;break;case i.up:var a=n.length-1,l=function(e){return e--,e},o=0===t.activeItem.index}if(null==t.activeItem.el){var c=t.results._find("a")[a];t.activeItem.el=c,t.activeItem.index=a,t.el.value=c._text(),t.statusBox._text(c._text()),c._triggerMouseEvent("mouseover")}else if(o)t.activeItem.el._removeClass(s.active),t.activeItem.el=null,t.activeItem.index=null,t.el.value=t.el.getAttribute(r.currentVal),t.statusBox._text(t.el.getAttribute(r.currentVal));else{var u=n[l(t.activeItem.index)]._find("a")[0];t.el.value=u._text(),t.statusBox._text(u._text()),u._triggerMouseEvent("mouseover")}return!1}};t(),o.create(this,e)},define("mindreader-vanilla",[],function(){}),require(["mindreader-vanilla"],function(){var e=document.getElementById("mindreader-demo-input");e.mindreader({ajaxUrl:"docs/js/fruits.json?q=",parseMatches:function(t){var n=[];return t.forEach(function(t){if(t.toLowerCase().indexOf(e.getAttribute("data-current-val").toLowerCase())>=0){var a=document.createElement("li"),s=document.createElement("a");s.href="#",s.innerHTML=t,a.appendChild(s),n.push(a)}}),n},actionType:"GET",minLength:2})}),define("demo-basic",["mindreader-vanilla"],function(){});